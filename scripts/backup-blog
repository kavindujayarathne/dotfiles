#!/usr/bin/env bash
set -euo pipefail

SRC="$HOME/Developer/personal-blog"
DEST="$HOME/Developer/personal-blog-snapshot"
SNAPSHOT="personal-blog.tar.gz"

echo "Creating snapshot..."
tar -czf "$DEST/$SNAPSHOT" -C "$(dirname "$SRC")" "$(basename "$SRC")"

# Split into <50MB parts to avoid GitHub large-file warnings
echo "Splitting into chunks..."
cd "$DEST"

# Remove any previous parts; if this fails, abort
rm -f personal-blog.tar.gz.part-*

# -b 49m keeps each file <50MB; -d numeric suffix; -a 3 -> .part-000, .part-001, ...
split -b 49m -d -a 3 "$SNAPSHOT" personal-blog.tar.gz.part-

# Remove the single large tarball; if this fails, abort
rm "$SNAPSHOT"

git add .
git commit -m "update: snapshot" || echo "No changes to commit."
git push origin main

echo "Snapshot split, committed, and pushed."
